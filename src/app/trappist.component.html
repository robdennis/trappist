<mat-toolbar color="primary" class="main-toolbar">
  <span>Trappist Deck Builder</span>
</mat-toolbar>

<div class="page-container">
  @if (isChecking()) {
    <!-- Optional: Add a loading spinner for the initial check -->
  } @else if (!dataExists()) {
    <app-database (dataLoaded)="checkIfDataExists()"></app-database>
  } @else {
    <div class="builder-section">
      <mat-card class="content-card control-panel">
        <mat-card-content class="button-row">

          <mat-form-field class="active-pack-selector">
            <mat-label>Visible Packs (up to 3)</mat-label>
            <mat-select [formControl]="packsControl" multiple>
              @for (pack of packs(); track pack.id) {
                <mat-option [value]="pack.id">{{ pack.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <button mat-stroked-button color="primary" (click)="addPack()">
            <mat-icon>add_circle_outline</mat-icon> Add New Pack
          </button>

          <button mat-stroked-button (click)="isTagEditorVisible.set(!isTagEditorVisible())">
            <mat-icon>label</mat-icon> {{ isTagEditorVisible() ? 'Hide' : 'Show' }} Tag Editor
          </button>

          <!-- ... Other control buttons ... -->
        </mat-card-content>
      </mat-card>

      @if(isTagEditorVisible()) {
        <app-tags></app-tags>
      }

      <div class="packs-container">
        @for (packId of visiblePackIds(); track packId) {
            @if (packs().find(p => p.id === packId); as pack) {
                <app-packs [pack]="pack" [tags]="tags()"></app-packs>
            }
        }
      </div>
    </div>
  }
</div>

